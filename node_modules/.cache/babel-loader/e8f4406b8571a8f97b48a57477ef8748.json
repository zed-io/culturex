{"ast":null,"code":"import _objectSpread from\"/Users/mvps/culturex/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/mvps/culturex/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/Users/mvps/culturex/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/Users/mvps/culturex/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/Users/mvps/culturex/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{sansPrefix}from\"@onflow/fcl\";import{atomFamily,selectorFamily,useRecoilState}from\"recoil\";import{useCurrentUser}from\"../hooks/use-current-user.hook\";import{fetchAccountItem}from\"../flow/fetch-account-item.script\";import{createSaleOffer}from\"../flow/create-sale-offer.tx\";import{IDLE,PROCESSING}from\"../global/constants\";import{useAccountItems}from\"../hooks/use-account-items.hook\";import{useMarketItems}from\"../hooks/use-market-items.hook\";function expand(key){return key.split(\"|\");}function comp(address,id){return[address,id].join(\"|\");}export var $state=atomFamily({key:\"account-item::state\",default:selectorFamily({key:\"account-item::default\",get:function get(key){return/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",fetchAccountItem.apply(void 0,_toConsumableArray(expand(key))));case 1:case\"end\":return _context.stop();}}},_callee);}));}})});export var $status=atomFamily({key:\"account-item::status\",default:IDLE});export function useAccountItem(address,id){var _useCurrentUser=useCurrentUser(),_useCurrentUser2=_slicedToArray(_useCurrentUser,1),cu=_useCurrentUser2[0];var accountItems=useAccountItems(address);var marketItems=useMarketItems(address);var key=comp(address,id);var _useRecoilState=useRecoilState($state(key)),_useRecoilState2=_slicedToArray(_useRecoilState,2),item=_useRecoilState2[0],setItem=_useRecoilState2[1];var _useRecoilState3=useRecoilState($status(key)),_useRecoilState4=_slicedToArray(_useRecoilState3,2),status=_useRecoilState4[0],setStatus=_useRecoilState4[1];return _objectSpread(_objectSpread({},item),{},{status:status,forSale:marketItems.has(id),owned:sansPrefix(cu.addr)===sansPrefix(address),sell:function sell(price){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return createSaleOffer({itemId:id,price:price},{onStart:function onStart(){setStatus(PROCESSING);},onSuccess:function onSuccess(){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:accountItems.refresh();marketItems.refresh();case 2:case\"end\":return _context2.stop();}}},_callee2);}))();},onComplete:function onComplete(){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setStatus(IDLE);case 1:case\"end\":return _context3.stop();}}},_callee3);}))();}});case 2:case\"end\":return _context4.stop();}}},_callee4);}))();},refresh:function refresh(){return _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:setStatus(PROCESSING);_context5.next=3;return fetchAccountItem.apply(void 0,_toConsumableArray(expand(key))).then(setItem);case 3:setStatus(IDLE);case 4:case\"end\":return _context5.stop();}}},_callee5);}))();}});}","map":{"version":3,"sources":["/Users/mvps/culturex/web/src/hooks/use-account-item.hook.js"],"names":["sansPrefix","atomFamily","selectorFamily","useRecoilState","useCurrentUser","fetchAccountItem","createSaleOffer","IDLE","PROCESSING","useAccountItems","useMarketItems","expand","key","split","comp","address","id","join","$state","default","get","$status","useAccountItem","cu","accountItems","marketItems","item","setItem","status","setStatus","forSale","has","owned","addr","sell","price","itemId","onStart","onSuccess","refresh","onComplete","then"],"mappings":"+sBAAA,OAAQA,UAAR,KAAyB,aAAzB,CACA,OAAQC,UAAR,CAAoBC,cAApB,CAAoCC,cAApC,KAAyD,QAAzD,CACA,OAAQC,cAAR,KAA6B,gCAA7B,CACA,OAAQC,gBAAR,KAA+B,mCAA/B,CACA,OAAQC,eAAR,KAA8B,8BAA9B,CACA,OAAQC,IAAR,CAAcC,UAAd,KAA+B,qBAA/B,CACA,OAAQC,eAAR,KAA8B,iCAA9B,CACA,OAAQC,cAAR,KAA6B,gCAA7B,CAEA,QAASC,CAAAA,MAAT,CAAgBC,GAAhB,CAAqB,CACnB,MAAOA,CAAAA,GAAG,CAACC,KAAJ,CAAU,GAAV,CAAP,CACD,CAED,QAASC,CAAAA,IAAT,CAAcC,OAAd,CAAuBC,EAAvB,CAA2B,CACzB,MAAO,CAACD,OAAD,CAAUC,EAAV,EAAcC,IAAd,CAAmB,GAAnB,CAAP,CACD,CAED,MAAO,IAAMC,CAAAA,MAAM,CAAGjB,UAAU,CAAC,CAC/BW,GAAG,CAAE,qBAD0B,CAE/BO,OAAO,CAAEjB,cAAc,CAAC,CACtBU,GAAG,CAAE,uBADiB,CAEtBQ,GAAG,CAAE,aAAAR,GAAG,6EAAI,mKAAYP,gBAAgB,MAAhB,2BAAoBM,MAAM,CAACC,GAAD,CAA1B,EAAZ,wDAAJ,IAFc,CAAD,CAFQ,CAAD,CAAzB,CAQP,MAAO,IAAMS,CAAAA,OAAO,CAAGpB,UAAU,CAAC,CAChCW,GAAG,CAAE,sBAD2B,CAEhCO,OAAO,CAAEZ,IAFuB,CAAD,CAA1B,CAKP,MAAO,SAASe,CAAAA,cAAT,CAAwBP,OAAxB,CAAiCC,EAAjC,CAAqC,qBAC7BZ,cAAc,EADe,oDACnCmB,EADmC,qBAE1C,GAAMC,CAAAA,YAAY,CAAGf,eAAe,CAACM,OAAD,CAApC,CACA,GAAMU,CAAAA,WAAW,CAAGf,cAAc,CAACK,OAAD,CAAlC,CACA,GAAMH,CAAAA,GAAG,CAAGE,IAAI,CAACC,OAAD,CAAUC,EAAV,CAAhB,CAJ0C,oBAKlBb,cAAc,CAACe,MAAM,CAACN,GAAD,CAAP,CALI,oDAKnCc,IALmC,qBAK7BC,OAL6B,0CAMdxB,cAAc,CAACkB,OAAO,CAACT,GAAD,CAAR,CANA,qDAMnCgB,MANmC,qBAM3BC,SAN2B,qBAQ1C,sCACKH,IADL,MAEEE,MAAM,CAANA,MAFF,CAGEE,OAAO,CAAEL,WAAW,CAACM,GAAZ,CAAgBf,EAAhB,CAHX,CAIEgB,KAAK,CAAEhC,UAAU,CAACuB,EAAE,CAACU,IAAJ,CAAV,GAAwBjC,UAAU,CAACe,OAAD,CAJ3C,CAKQmB,IALR,eAKaC,KALb,CAKoB,+NACV7B,CAAAA,eAAe,CACnB,CAAC8B,MAAM,CAAEpB,EAAT,CAAamB,KAAK,CAAEA,KAApB,CADmB,CAEnB,CACEE,OADF,mBACY,CACRR,SAAS,CAACrB,UAAD,CAAT,CACD,CAHH,CAIQ8B,SAJR,qBAIoB,wMAChBd,YAAY,CAACe,OAAb,GACAd,WAAW,CAACc,OAAZ,GAFgB,6DAGjB,CAPH,CAQQC,UARR,sBAQqB,wMACjBX,SAAS,CAACtB,IAAD,CAAT,CADiB,6DAElB,CAVH,CAFmB,CADL,8DAgBjB,CArBH,CAsBQgC,OAtBR,mBAsBkB,wMACdV,SAAS,CAACrB,UAAD,CAAT,CADc,uBAERH,CAAAA,gBAAgB,MAAhB,2BAAoBM,MAAM,CAACC,GAAD,CAA1B,GAAiC6B,IAAjC,CAAsCd,OAAtC,CAFQ,QAGdE,SAAS,CAACtB,IAAD,CAAT,CAHc,6DAIf,CA1BH,GA4BD","sourcesContent":["import {sansPrefix} from \"@onflow/fcl\"\nimport {atomFamily, selectorFamily, useRecoilState} from \"recoil\"\nimport {useCurrentUser} from \"../hooks/use-current-user.hook\"\nimport {fetchAccountItem} from \"../flow/fetch-account-item.script\"\nimport {createSaleOffer} from \"../flow/create-sale-offer.tx\"\nimport {IDLE, PROCESSING} from \"../global/constants\"\nimport {useAccountItems} from \"../hooks/use-account-items.hook\"\nimport {useMarketItems} from \"../hooks/use-market-items.hook\"\n\nfunction expand(key) {\n  return key.split(\"|\")\n}\n\nfunction comp(address, id) {\n  return [address, id].join(\"|\")\n}\n\nexport const $state = atomFamily({\n  key: \"account-item::state\",\n  default: selectorFamily({\n    key: \"account-item::default\",\n    get: key => async () => fetchAccountItem(...expand(key)),\n  }),\n})\n\nexport const $status = atomFamily({\n  key: \"account-item::status\",\n  default: IDLE,\n})\n\nexport function useAccountItem(address, id) {\n  const [cu] = useCurrentUser()\n  const accountItems = useAccountItems(address)\n  const marketItems = useMarketItems(address)\n  const key = comp(address, id)\n  const [item, setItem] = useRecoilState($state(key))\n  const [status, setStatus] = useRecoilState($status(key))\n\n  return {\n    ...item,\n    status,\n    forSale: marketItems.has(id),\n    owned: sansPrefix(cu.addr) === sansPrefix(address),\n    async sell(price) {\n      await createSaleOffer(\n        {itemId: id, price: price},\n        {\n          onStart() {\n            setStatus(PROCESSING)\n          },\n          async onSuccess() {\n            accountItems.refresh()\n            marketItems.refresh()\n          },\n          async onComplete() {\n            setStatus(IDLE)\n          },\n        }\n      )\n    },\n    async refresh() {\n      setStatus(PROCESSING)\n      await fetchAccountItem(...expand(key)).then(setItem)\n      setStatus(IDLE)\n    },\n  }\n}\n"]},"metadata":{},"sourceType":"module"}